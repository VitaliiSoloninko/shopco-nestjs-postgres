# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Refresh Token —á–µ—Ä–µ–∑ Postman

## ‚ö†Ô∏è –í–∞–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Postman

**–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É cookies!**

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Postman –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å cookies:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Postman
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** (‚öôÔ∏è –∏–∫–æ–Ω–∫–∞ —Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É)
3. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **General**
4. –í–∫–ª—é—á–∏—Ç–µ –æ–ø—Ü–∏—é **"Automatically follow redirects"**
5. –í–∫–ª—é—á–∏—Ç–µ –æ–ø—Ü–∏—é **"Send cookies with requests"**
6. –í —Ä–∞–∑–¥–µ–ª–µ **Cookies** —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω `localhost` —Ä–∞–∑—Ä–µ—à–µ–Ω

---

## üìã –ü–æ—à–∞–≥–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

**Endpoint:** `POST http://localhost:5000/api/auth/register`

**Headers:**

```
Content-Type: application/json
```

**Body (raw JSON):**

```json
{
  "email": "test@example.com",
  "password": "Test123456",
  "firstName": "Test",
  "lastName": "User"
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (201 Created):**

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

- ‚úÖ –°—Ç–∞—Ç—É—Å: `201 Created`
- ‚úÖ –í –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å `access_token`
- ‚úÖ –í **Cookies** –ø–æ—è–≤–∏–ª—Å—è `refreshToken` (httpOnly)
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫–µ **Cookies** –ø–æ–¥ –∫–Ω–æ–ø–∫–æ–π Send
  - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å cookie —Å –∏–º–µ–Ω–µ–º `refreshToken`

---

### **–®–∞–≥ 2: –õ–æ–≥–∏–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

**Endpoint:** `POST http://localhost:5000/api/auth/login`

**Headers:**

```
Content-Type: application/json
```

**Body (raw JSON):**

```json
{
  "email": "test@example.com",
  "password": "Test123456"
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (200 OK):**

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

- ‚úÖ –°—Ç–∞—Ç—É—Å: `200 OK`
- ‚úÖ –í –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å –Ω–æ–≤—ã–π `access_token`
- ‚úÖ Cookie `refreshToken` –æ–±–Ω–æ–≤–∏–ª—Å—è (–Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)

---

### **–®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ access token)**

**Endpoint:** `GET http://localhost:5000/api/auth/profile`

**Headers:**

```
Authorization: Bearer <–≤–∞—à_access_token_–∏–∑_—à–∞–≥–∞_2>
Content-Type: application/json
```

> ‚ö†Ô∏è –ó–∞–º–µ–Ω–∏—Ç–µ `<–≤–∞—à_access_token_–∏–∑_—à–∞–≥–∞_2>` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (200 OK):**

```json
{
  "id": 1,
  "email": "test@example.com",
  "firstName": "Test",
  "lastName": "User",
  "role": "user",
  "isActive": false,
  "createdAt": "2025-12-23T...",
  "updatedAt": "2025-12-23T..."
}
```

**üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

- ‚úÖ –°—Ç–∞—Ç—É—Å: `200 OK`
- ‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –í –æ—Ç–≤–µ—Ç–µ –Ω–µ—Ç –ø–æ–ª—è `password` (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

---

### **–®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (refresh)**

**Endpoint:** `POST http://localhost:5000/api/auth/refresh`

**Headers:**

```
Content-Type: application/json
```

> ‚ö†Ô∏è **–ù–ï –ù–£–ñ–ù–û** –¥–æ–±–∞–≤–ª—è—Ç—å Authorization header!  
> Refresh token –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ cookie

**Body:** –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –∏–ª–∏ `{}`

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (200 OK):**

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

- ‚úÖ –°—Ç–∞—Ç—É—Å: `200 OK`
- ‚úÖ –ü–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π `access_token`
- ‚úÖ Cookie `refreshToken` –æ–±–Ω–æ–≤–∏–ª—Å—è (–Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
- ‚úÖ –ó–∞–ø—Ä–æ—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó Authorization header (—Ç–æ–ª—å–∫–æ cookie)

---

### **–®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ access token**

**Endpoint:** `GET http://localhost:5000/api/auth/profile`

**Headers:**

```
Authorization: Bearer <–Ω–æ–≤—ã–π_access_token_–∏–∑_—à–∞–≥–∞_4>
Content-Type: application/json
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (200 OK):**

```json
{
  "id": 1,
  "email": "test@example.com",
  ...
}
```

**üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

- ‚úÖ –ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è

---

### **–®–∞–≥ 6: –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã (logout)**

**Endpoint:** `POST http://localhost:5000/api/auth/logout`

**Headers:**

```
Authorization: Bearer <–≤–∞—à_access_token>
Content-Type: application/json
```

**Body:** –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –∏–ª–∏ `{}`

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (200 OK):**

```json
{
  "message": "Logged out successfully"
}
```

**üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

- ‚úÖ –°—Ç–∞—Ç—É—Å: `200 OK`
- ‚úÖ Cookie `refreshToken` —É–¥–∞–ª–µ–Ω (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫–µ Cookies)

---

### **–®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ refresh –±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**

**Endpoint:** `POST http://localhost:5000/api/auth/refresh`

**Headers:**

```
Content-Type: application/json
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (401 Unauthorized):**

```json
{
  "statusCode": 401,
  "message": "Unauthorized"
}
```

**üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

- ‚úÖ –°—Ç–∞—Ç—É—Å: `401 Unauthorized`
- ‚úÖ –ü–æ—Å–ª–µ logout refresh token –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω

---

## üß™ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

### **–¢–µ—Å—Ç 8: –ü–æ–ø—ã—Ç–∫–∞ refresh —Å –Ω–µ–≤–µ—Ä–Ω—ã–º cookie**

1. –£–¥–∞–ª–∏—Ç–µ cookie `refreshToken` –≤—Ä—É—á–Ω—É—é
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–∑–≤–∞—Ç—å `POST /api/auth/refresh`
3. –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ `401 Unauthorized`

### **–¢–µ—Å—Ç 9: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ access token (15 –º–∏–Ω—É—Ç)**

1. –ü–æ–ª—É—á–∏—Ç–µ access token —á–µ—Ä–µ–∑ login
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 16 –º–∏–Ω—É—Ç ‚è∞
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è `/api/auth/profile`
4. –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ `401 Unauthorized`
5. –í—ã–∑–æ–≤–∏—Ç–µ `/api/auth/refresh` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
6. –ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å

---

## üìä –¢–∞–±–ª–∏—Ü–∞ endpoint'–æ–≤

| Endpoint             | –ú–µ—Ç–æ–¥ | Auth      | Cookie   | –û–ø–∏—Å–∞–Ω–∏–µ                               |
| -------------------- | ----- | --------- | -------- | -------------------------------------- |
| `/api/auth/register` | POST  | ‚ùå        | ‚úÖ Set   | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + —É—Å—Ç–∞–Ω–æ–≤–∫–∞ refresh cookie |
| `/api/auth/login`    | POST  | ‚ùå        | ‚úÖ Set   | –í—Ö–æ–¥ + —É—Å—Ç–∞–Ω–æ–≤–∫–∞ refresh cookie        |
| `/api/auth/refresh`  | POST  | ‚ùå        | ‚úÖ Read  | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (—á–∏—Ç–∞–µ—Ç cookie)     |
| `/api/auth/logout`   | POST  | ‚úÖ Bearer | ‚úÖ Clear | –í—ã—Ö–æ–¥ + –æ—á–∏—Å—Ç–∫–∞ cookie                 |
| `/api/auth/profile`  | GET   | ‚úÖ Bearer | ‚ùå       | –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è                      |

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ª–æ–≥–∏–Ω —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç httpOnly cookie
- ‚úÖ Refresh endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó Authorization header
- ‚úÖ Refresh endpoint —á–∏—Ç–∞–µ—Ç cookie –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ü–æ—Å–ª–µ logout refresh token —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –ë–î
- ‚úÖ Cookie –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ logout
- ‚úÖ Access token –∂–∏–≤–µ—Ç 15 –º–∏–Ω—É—Ç
- ‚úÖ Refresh token –∂–∏–≤–µ—Ç 30 –¥–Ω–µ–π
- ‚úÖ –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoint'—ã —Ç—Ä–µ–±—É—é—Ç Bearer token

---

## üîß –ü—Ä–æ—Å–º–æ—Ç—Ä cookies –≤ Postman

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É **Cookies** –ø–æ–¥ –∫–Ω–æ–ø–∫–æ–π Send
2. –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º–µ–Ω `localhost:5000`
3. –£–≤–∏–¥–∏—Ç–µ –≤—Å–µ cookies –¥–ª—è —ç—Ç–æ–≥–æ –¥–æ–º–µ–Ω–∞

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ Console

1. –û—Ç–∫—Ä–æ–π—Ç–µ Console –≤ Postman (–≤–Ω–∏–∑—É)
2. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **Response Headers**
3. –ò—â–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Set-Cookie`

---

## üìù –ü—Ä–∏–º–µ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–∏ Postman

–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é "ShopCo Refresh Token Tests" —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏:

```
üìÅ ShopCo Refresh Token Tests
  ‚îú‚îÄ‚îÄ 1Ô∏è‚É£ Register User
  ‚îú‚îÄ‚îÄ 2Ô∏è‚É£ Login User
  ‚îú‚îÄ‚îÄ 3Ô∏è‚É£ Get Profile (with access token)
  ‚îú‚îÄ‚îÄ 4Ô∏è‚É£ Refresh Tokens
  ‚îú‚îÄ‚îÄ 5Ô∏è‚É£ Get Profile (with new token)
  ‚îú‚îÄ‚îÄ 6Ô∏è‚É£ Logout
  ‚îî‚îÄ‚îÄ 7Ô∏è‚É£ Try Refresh After Logout (should fail)
```

---

## ‚ö†Ô∏è Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Cookie –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Postman (Settings ‚Üí General)
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ "Send cookies with requests" –≤–∫–ª—é—á–µ–Ω–æ
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Postman Desktop –≤–º–µ—Å—Ç–æ Web –≤–µ—Ä—Å–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞: 401 –Ω–∞ /refresh endpoint

**–†–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ cookie `refreshToken` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–µ –∏—Å—Ç–µ–∫ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (30 –¥–Ω–µ–π)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤—ã–∑—ã–≤–∞–ª logout

### –ü—Ä–æ–±–ª–µ–º–∞: Access token –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫ (15 –º–∏–Ω—É—Ç)
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: `Bearer <token>`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ .env —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π JWT_SECRET

---

**–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É refresh token –≤ Postman! üéâ**
